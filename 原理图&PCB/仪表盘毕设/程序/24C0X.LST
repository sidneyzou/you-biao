C51 COMPILER V9.51   24C0X                                                                 05/08/2015 22:55:53 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE 24C0X
OBJECT MODULE PLACED IN 24C0X.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE 24C0X.c LARGE OPTIMIZE(9,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**********************ÍâÀ©24C0XÏµÁÐEEPROMº¯ÊýÎÄ¼þ*********************************
   2          *  ¾§Õñ:11.0592MHZ
   3          ******************************************************************/
   4          
   5          /**********************°üº¬ÎÄ¼þ*******************/
   6          #include "24C0X.h"
   7          
   8          /*********************************È«¾Ö±ä³õÊ¼»¯***********************************/  
   9          
  10          
  11          /******************************************************************************/
  12          /* º¯ÊýÃû³Æ  : EEPROM_Init                                                    */
  13          /* º¯ÊýÃèÊö  : ÍâÀ©EEPROM³õÊ¼»¯                                               */
  14          /* ÊäÈë²ÎÊý  : Void                                                           */
  15          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
  16          /* ·µ»ØÖµ    : ÎÞ                                                             */
  17          /******************************************************************************/  
  18          void EEPROM_Init(void)  //24c0X³õÊ¼»¯×Ó³ÌÐò  I2C×ÜÏß´«Êä
  19          {
  20   1        eeprom_scl = 1;  //À­¸ß¿ØÖÆÏß
  21   1        EEPROM_Nop();  
  22   1        eeprom_sda = 1;  //À­¸ßÊý¾ÝÏß
  23   1        EEPROM_Nop();
  24   1      }
  25          /******************************************************************************/
  26          /* º¯ÊýÃû³Æ  : EEPROM_Start                                                   */
  27          /* º¯ÊýÃèÊö  : ÍâÀ©EEPROM I2CÆô¶¯                                             */
  28          /* ÊäÈë²ÎÊý  : Void                                                           */
  29          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
  30          /* ·µ»ØÖµ    : ÎÞ                                                             */
  31          /******************************************************************************/  
  32          void EEPROM_Start(void)        //Æô¶¯I2C×ÜÏß
  33          {
  34   1        eeprom_sda = 1;  //À­¸ßÊý¾ÝÏß
  35   1        EEPROM_Nop();
  36   1        eeprom_scl = 1;  //À­¸ß¿ØÖÆÏß
  37   1        EEPROM_Nop();
  38   1        eeprom_sda = 0;  //À­µÍÊý¾ÝÏß
  39   1        EEPROM_Nop();
  40   1        eeprom_scl = 0;  //À­µÍ¿ØÖÆÏß
  41   1        EEPROM_Nop();
  42   1      }
  43          /******************************************************************************/
  44          /* º¯ÊýÃû³Æ  : EEPROM_Stop                                                    */
  45          /* º¯ÊýÃèÊö  : Í£Ö¹I2C×ÜÏß                                                    */
  46          /* ÊäÈë²ÎÊý  : Void                                                           */
  47          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
  48          /* ·µ»ØÖµ    : ÎÞ                                                             */
  49          /******************************************************************************/  
  50          void EEPROM_Stop(void)         //Í£Ö¹I2C×ÜÏß
  51          {
  52   1        eeprom_sda = 0;   //À­µÍÊý¾ÝÏß
  53   1        EEPROM_Nop();
  54   1        eeprom_scl = 1;   //À­¸ß¿ØÖÆÏß
  55   1        EEPROM_Nop();
C51 COMPILER V9.51   24C0X                                                                 05/08/2015 22:55:53 PAGE 2   

  56   1        eeprom_sda = 1;   //À­µÍÊý¾ÝÏß
  57   1        EEPROM_Nop();
  58   1      }
  59          /******************************************************************************/
  60          /* º¯ÊýÃû³Æ  : EEPROM_Write_Byte                                              */
  61          /* º¯ÊýÃèÊö  : KEYÉ¨Ãè                                                        */
  62          /* ÊäÈë²ÎÊý  : Void                                                           */
  63          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
  64          /* ·µ»ØÖµ    : ÎÞ                                                             */
  65          /******************************************************************************/  
  66          void EEPROM_Write_Byte(uchar dat)  //Ð´Ò»¸ö×Ö½Ú
  67          {
  68   1         uchar i,temp;
  69   1         temp = dat;
  70   1         for (i = 0; i < 8; i++)
  71   1         {
  72   2           temp = temp<<1;
  73   2           eeprom_scl = 0;    //À­µÍ¿ØÖÆÏß
  74   2           EEPROM_Nop();
  75   2           eeprom_sda = CY;   //temp×óÒÆÊ±£¬ÒÆ³öµÄÖµ·ÅÈëÁËCYÖÐ
  76   2           EEPROM_Nop();
  77   2           eeprom_scl = 1;    //´ýsdaÏßÉÏµÄÊý¾ÝÎÈ¶¨ºó£¬½«sclÀ­¸ß
  78   2           EEPROM_Nop();
  79   2         }
  80   1         eeprom_scl = 0;    //À­µÍ¿ØÖÆÏß
  81   1         EEPROM_Nop();
  82   1         eeprom_sda = 1;   //À­¸ßÊý¾ÝÏß
  83   1         EEPROM_Nop();
  84   1      }
  85          /******************************************************************************/
  86          /* º¯ÊýÃû³Æ  : EEPROM_Read_Byte                                               */
  87          /* º¯ÊýÃèÊö  : KEYÉ¨Ãè                                                        */
  88          /* ÊäÈë²ÎÊý  : Void                                                           */
  89          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
  90          /* ·µ»ØÖµ    : ÎÞ                                                             */
  91          /******************************************************************************/  
  92          uchar EEPROM_Read_Byte(void)   //¶ÁÒ»¸ö×Ö½Ú
  93          {
  94   1         uchar i,j,dat = 0;
  95   1         eeprom_scl = 0; EEPROM_Nop(); eeprom_sda = 1;
  96   1         for (i=0;i<8;i++)
  97   1         {  
  98   2          EEPROM_Nop(); eeprom_scl = 1; EEPROM_Nop();
  99   2              if(eeprom_sda == 1) 
 100   2                j = 1;
 101   2              else
 102   2                j = 0;
 103   2              dat = (dat << 1) | j;
 104   2            eeprom_scl = 0;
 105   2        }
 106   1          EEPROM_Nop();
 107   1        return (dat);
 108   1      }
 109          /******************************************************************************/
 110          /* º¯ÊýÃû³Æ  : EEPROM_Clock                                                   */
 111          /* º¯ÊýÃèÊö  : EEPROMÊ±ÖÓÊ±Ðò                                                 */
 112          /* ÊäÈë²ÎÊý  : Void                                                           */
 113          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
 114          /* ·µ»ØÖµ    : ÎÞ                                                             */
 115          /******************************************************************************/  
 116          void EEPROM_Clock(void)         //I2C×ÜÏßÊ±ÖÓ
 117          {
C51 COMPILER V9.51   24C0X                                                                 05/08/2015 22:55:53 PAGE 3   

 118   1         uchar i = 0;
 119   1         eeprom_scl = 1;                     //À­¸ß¿ØÖÆÏß
 120   1         EEPROM_Nop();
 121   1         while((eeprom_sda == 1) && (i < 255))  //ÅÐ¶¨Êý¾ÝÊÇ·ñËÍ´ï»òÕßÊÕµ½
 122   1            i++;
 123   1         eeprom_scl = 0;                   //À­µÍ¿ØÖÆÏß
 124   1         EEPROM_Nop();
 125   1      }
 126          /******************************************************************************/
 127          /* º¯ÊýÃû³Æ  : EEPROM_Read                                                    */
 128          /* º¯ÊýÃèÊö  : EEPROM¶ÁÈ¡Êý¾ÝÊ±Ðò                                             */
 129          /* ÊäÈë²ÎÊý  : uchar add                                                      */
 130          /* ²ÎÊýÃèÊö  : ÐèÒª¶ÁÈ¡µÄµØÖ·                                                 */
 131          /* ·µ»ØÖµ    : ÎÞ                                                             */
 132          /******************************************************************************/  
 133          uchar EEPROM_Read(uchar add)
 134          {
 135   1         uchar dat;
 136   1         EEPROM_Start();          //¿ªÊ¼Ê±Ðò
 137   1         EEPROM_Write_Byte(0xa0); //Ð´Èë¿ØÖÆ·û
 138   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 139   1        
 140   1         EEPROM_Write_Byte(add);  //Ð´ÈëµØÖ·
 141   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 142   1        
 143   1         EEPROM_Start();          //¿ªÊ¼Ê±Ðò
 144   1         EEPROM_Write_Byte(0xa1); //Ð´Èë¿ØÖÆ·û
 145   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 146   1        
 147   1         dat = EEPROM_Read_Byte();//¶ÁÈ¡Êý¾Ý
 148   1         EEPROM_Stop();           //¹Ø±ÕÊ±Ðò
 149   1         EEPROM_Delay(100);      //ÑÓÊ±µÈ´ý
 150   1         return(dat);
 151   1      }
 152          /******************************************************************************/
 153          /* º¯ÊýÃû³Æ  : EEPROM_Write                                                   */
 154          /* º¯ÊýÃèÊö  : EEPROMÐ´ÈëÊý¾ÝÊ±Ðò                                             */
 155          /* ÊäÈë²ÎÊý  : unchar add, uchar dat                                          */
 156          /* ²ÎÊýÃèÊö  : Ð´ÈëµÄµØÖ·£¬Ð´ÈëµÄÊý¾Ý                                         */
 157          /* ·µ»ØÖµ    : ÎÞ                                                             */
 158          /******************************************************************************/  
 159          void EEPROM_Write(uchar add,uchar dat)
 160          {
 161   1         EEPROM_Start();          //¿ªÊ¼Ê±Ðò
 162   1         EEPROM_Write_Byte(0xa0); //Ð´Èë¿ØÖÆ·û
 163   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 164   1        
 165   1         EEPROM_Write_Byte(add);  //Ð´ÈëµØÖ·
 166   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 167   1        
 168   1         EEPROM_Write_Byte(dat);  //Ð´ÈëÊý¾Ý
 169   1         EEPROM_Clock();          //Ê±ÖÓÊ±Ðò
 170   1        
 171   1         EEPROM_Stop();           //¹Ø±ÕÊ±Ðò
 172   1         EEPROM_Delay(5000);     //Õâ¸öÑÓÊ±Ò»¶¨Òª×ã¹»³¤£¬·ñÔò»á³ö´í¡£ÒòÎª24c02ÔÚ´ÓsdaÉÏÈ¡µÃÊý¾Ýºó£¬»¹ÐèÒªÒ»¶¨Ê±¼
             -äµÄÉÕÂ¼¹ý³Ì¡£
 173   1      }
 174          
 175          
 176          /******************************************************************************/
 177          /* º¯ÊýÃû³Æ  : EEPROM_Nop                                                     */
 178          /* º¯ÊýÃèÊö  : ÑÓÊ±³ÌÐò                                                       */
C51 COMPILER V9.51   24C0X                                                                 05/08/2015 22:55:53 PAGE 4   

 179          /* ÊäÈë²ÎÊý  : Void                                                           */
 180          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
 181          /* ·µ»ØÖµ    : ÎÞ                                                             */
 182          /******************************************************************************/  
 183          void EEPROM_Nop(void)
 184          {
 185   1        _nop_();
 186   1        _nop_();
 187   1      }
 188          
 189          /******************************************************************************/
 190          /* º¯ÊýÃû³Æ  : EEPROM_Delay                                                   */
 191          /* º¯ÊýÃèÊö  : ÑÓÊ±³ÌÐò                                                       */
 192          /* ÊäÈë²ÎÊý  : Void                                                           */
 193          /* ²ÎÊýÃèÊö  : ÎÞ                                                             */
 194          /* ·µ»ØÖµ    : ÎÞ                                                             */
 195          /******************************************************************************/  
 196          void EEPROM_Delay(uint m)
 197          { 
 198   1        uint n;
 199   1        for(n = 0; n < m; n++);
 200   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    344    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
