C51 COMPILER V9.51   PWM                                                                   05/08/2015 22:55:54 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN PWM.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE PWM.c LARGE OPTIMIZE(9,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**********************PWM波函数文件*********************************
   2          *  晶振:12MHZ
   3          ******************************************************************/
   4          
   5          /**********************包含文件*******************/
   6          #include "PWM.h"
   7          /*********************************全局变初始化***********************************/  
   8          
   9          #ifdef PWM_0
  10          uint pwm_set_0 = 0,pwm_cycle_0 = 0;
  11          /******************************************************************************/
  12          /* 函数名称  : PWM_Init_0                                                     */
  13          /* 函数描述  : PWM波0号定时器初始化 占用定时器0                               */
  14          /* 输入参数  : Void                                                           */
  15          /* 参数描述  : 无                                                             */
  16          /* 返回值    : 无                                                             */
  17          /******************************************************************************/  
  18          void PWM_Init_0(void)//定时器初始化
  19          {
  20   1        EA = 0;
  21   1        TMOD &= 0XF0;    //清除定时器0
  22   1        TMOD |= 0x01;    //初始化定时器
  23   1        PWM_Port0 = 1;//反相0
  24   1        TH0 = -(pwm_set_0 / 256); TL0= -(pwm_set_0 % 256);
  25   1        //EA = 1;
  26   1        ET0 = 1; TR0 = 1;
  27   1        
  28   1      }
  29          /******************************************************************************/
  30          /* 函数名称  : PWM_Timer0                                                     */
  31          /* 函数描述  : PWM波0号中断服务函数                                           */
  32          /* 输入参数  : Void                                                           */
  33          /* 参数描述  : 无                                                             */
  34          /* 返回值    : 无                                                             */
  35          /******************************************************************************/  
  36          void PWM_Timer0(void) interrupt 1
  37          {
  38   1        if(PWM_Port0 == 0)
  39   1        {
  40   2          TH0 = -(pwm_set_0 / 256); 
  41   2          TL0 = -(pwm_set_0 % 256);
  42   2          PWM_Port0 = 1;
  43   2        }//正向执行时间
  44   1        else
  45   1        {
  46   2          TH0 = -((pwm_cycle_0 - pwm_set_0) / 256); 
  47   2          TL0 = -((pwm_cycle_0 - pwm_set_0) % 256);
  48   2          PWM_Port0 = 0;
  49   2        }//空比执行时间
  50   1      }
  51          #endif
  52          
  53          
  54          #ifdef PWM_1
              uint pwm_set_1 = 0,pwm_cycle_1 = 0;
C51 COMPILER V9.51   PWM                                                                   05/08/2015 22:55:54 PAGE 2   

              /******************************************************************************/
              /* 函数名称  : PWM_Init_1                                                     */
              /* 函数描述  : PWM波1号定时器初始化 占用定时器1                               */
              /* 输入参数  : Void                                                           */
              /* 参数描述  : 无                                                             */
              /* 返回值    : 无                                                             */
              /******************************************************************************/    
              void PWM_Init_1(void)//定时器初始化
              {
                EA = 0;
                TMOD &= 0X0F;    //清除定时器1
                TMOD |= 0x10;    //初始化定时器
                PWM_Port1 = 1;//反相0
                TH1 = -(pwm_set_1 / 256); TL1= -(pwm_set_1 % 256);
                EA = 1;
                ET1 = 1; TR1 = 1;
                
              }
              /******************************************************************************/
              /* 函数名称  : PWM_Timer1                                                     */
              /* 函数描述  : PWM波1号中断服务函数                                           */
              /* 输入参数  : Void                                                           */
              /* 参数描述  : 无                                                             */
              /* 返回值    : 无                                                             */
              /******************************************************************************/  
              void PWM_Timer1(void) interrupt 3 
              {
                if(PWM_Port1 == 0)
                {
                  TH1 = -(pwm_set_1 / 256); 
                  TL1 = -(pwm_set_1 % 256);
                  PWM_Port1 = 1;
                }//正向执行时间
                else
                {
                  TH1 = -((pwm_cycle_1 - pwm_set_1) / 256); 
                  TL1 = -((pwm_cycle_1 - pwm_set_1) % 256);
                  PWM_Port1 = 0;
                }//空比执行时间
              }
              #endif
  97           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    116    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
